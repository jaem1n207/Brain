---
tags:
  - network
  - tcp
  - udp
---
데이터의 순서가 바뀌지 않으면서 데이터가 유실되지 않도록 가급적 빠르게 데이터를 보내려면 네트워크 프로토콜을 어떻게 설계해야 할까요? TCP/IP는 이런 고민 아래 설계된 것입니다.
## UDP
데이터를 전송하기 전에 연결을 설정하지 않고 초기 설정 없이 데이터그램만 보냅니다. `UDP`는 다음과 같은 특성을 가집니다.

- 신뢰할 수 없음: 전송된 데이터가 상대방에서 수신된다는 보장이 없습니다.
- 순서대로 전달하지 않음: 데이터그램이 순서에 맞지 않게 도착하거나, 중복되거나, 예고 없이 누락될 수 있습니다.
- 흐름 제어 없음: 발신자가 네트워크 상태를 조정하지 않고 데이터그램을 내보내므로 잠재적으로 패킷 손실이 발생할 수도 있습니다.
- 경량: 최소한의 헤더와 연결 설정이 없으므로 오버헤드가 줄어들고 전송 속도가 빠릅니다.
- 오류 복구 없음: 데이터가 손상되었는지 확인하기 위한 기본적인 오류 검사 기능은 있지만 손실된 데이터그램을 복구하지는 않습니다.

일반적으로 신뢰성이 요구되는 상황에는 적합하지 않습니다. 안정성보다 속도가 더 중요한 상황에서 적합합니다. 주로 사용되는 상황은 라이브 스트리밍(일부 프로토콜), Voice over IP(스카이프, 줌), DNS 쿼리가 있습니다.
## TCP
데이터를 전송하기 전에 `3-way Handshake`를 사용하여 발신자와 수신자 간에 연결을 설정해야 합니다. `TCP`는 다음과 같은 특성을 가집니다.

- 연결 지향: 데이터를 전송하기 전에 3-way Handshake를 사용하여 발신자와 수신자 간에 연결을 설정합니다.
- 신뢰성: 안정적인 데이터 전송을 제공할 수 있습니다. 전송 중에 세그먼트(데이터 조각)가 손상되면 TCP는 이를 감지하고 재전송을 요청합니다.
- 순서 번호 부여: 세그먼트에는 순서 번호를 지정해서 데이터가 전송된 순서와 동일한 순서로 수신 앱에 전달되도록 보장합니다.
- 흐름 제어: [sliding window](https://www.ibm.com/docs/en/spectrum-protect/8.1.11?topic=tuning-tcp-flow-control) 메커니즘을 활용해서 한 번에 너무 많은 데이터에 매몰되지 않도록 합니다.
- 오류 검사: 오류 검사 및 수정을 위한 메커니즘이 포함되어 데이터 무결성을 보장합니다.
- 혼잡 제어: 네트워크 상황에 적응하여 네트워크 혼잡이 감지되면 전송 속도를 줄입니다.

안정성 기능으로 인한 오버헤드로 인해 UDP에 비해 속도가 느립니다. 그리고 stateful connection 특성으로 인해 더 많은 리소스를 사용합니다. 주로 사용되는 상황은 웹사이트(HTTP/HTTPS), 파일 전송(FTP), 이메일(SMTP, POP3, IMAP)이 있습니다.
## 비교
이제 UDP와 TCP를 간단히 비교해보겠습니다.

- TCP는 연결 지향적이므로 설정 단계가 필요한 반면 UDP는 연결을 설정하지 않기에 설정 단계가 필요 없습니다.
- 신뢰성: TCP는 승인, 재전송 및 오류 복구를 통해 안정적인 데이터 전송을 제공합니다. UDP는 그렇지 않습니다.
- 순서 지정: TCP는 순서가 지정된 세그먼트 전달을 보장합니다. UDP는 패킷을 순서 없이 전달합니다.
- 속도: UDP는 일반적으로 낮은 대기시간과 오버헤드 때문에 일부 앱의 경우 더 빠릅니다. TCP는 안정성 메커니즘으로 인해 지연이 발생할 수 있습니다.
- 사용 상황: TCP는 파일 전송이나 웹 페이지 로딩과 같이 안정성과 데이터 무결성이 중요한 곳에 사용됩니다. UDP는 안정성보다 속도가 더 중요한 비디오 스트리밍이나 온라인 게임과 같은 실시간 상황에 사용됩니다.
- 헤더 크기: TCP 헤더는 UDP 헤더(8 bytes)에 비해 더 큽니다(20-60 bytes)
- 오류 검사: 두 프로토콜 모두 오류 검사 기능이 있지만 TCP에만 오류 복구 기능이 있습니다.

TCP와 UDP 중 어느 것을 사용할지는 앱의 특정 요구 사항에 따라 결정됩니다. **신뢰성, 데이터 무결성 및 순서**가 가장 중요한 경우에는 **TCP**가 선택됩니다. **낮은 대기 시간, 속도 또는 실시간 전송**이 더 중요한 경우에는 **UDP**가 더 나은 선택일 수 있습니다.
## 참고
- [Jbee/Interview_Question_for_Beginner](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/blob/main/Network/README.md#tcp%EC%99%80-udp%EC%9D%98-%EB%B9%84%EA%B5%90)
- [d2-TCP/IP 네트워크 스택 이해하기](https://d2.naver.com/helloworld/47667)